{% extends 'opticut/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'opticut/css/calcular_tiempo.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card fade-in">
        <div class="card-header bg-primary text-white">
          <h3 class="mb-0">‚è±Ô∏è Calculadora de Tiempo Estimado de Corte</h3>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <h5>üìã Informaci√≥n de la Optimizaci√≥n</h5>
            <p class="mb-1"><strong>Optimizaci√≥n #{{ optimizacion.id }}</strong></p>
            <p class="mb-1"><strong>üìê Tablero:</strong> {{ ancho_mostrar }} √ó {{ alto_mostrar }} {{ unidad_medida }}</p>
            <p class="mb-1"><strong>üìä Aprovechamiento:</strong> {{ optimizacion.aprovechamiento_total|floatformat:2 }}%</p>
            <p class="mb-1"><strong>üìÖ Fecha:</strong> {{ optimizacion.fecha|date:"d/m/Y H:i" }}</p>
          </div>

          <hr>

          <div class="mb-4">
            <h5>üìä Resumen de Piezas</h5>
            <div class="row">
              <div class="col-md-4">
                <div class="card bg-light">
                  <div class="card-body text-center">
                    <h6 class="text-muted">Total de Piezas</h6>
                    <h3 class="text-primary">{{ total_piezas }}</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card bg-light">
                  <div class="card-body text-center">
                    <h6 class="text-muted">Tipos de Piezas</h6>
                    <h3 class="text-info">{{ tipos_piezas }}</h3>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card bg-light">
                  <div class="card-body text-center">
                    <h6 class="text-muted">Tableros Estimados</h6>
                    <h3 class="text-success">{{ num_tableros_estimado }}</h3>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <hr>

          <div class="mb-4">
            <h5>‚è±Ô∏è Tiempo Estimado de Corte</h5>
            <div class="alert alert-info">
              <h4 class="alert-heading">Tiempo Total Estimado</h4>
              <p class="mb-0 tiempo-total">
                {{ tiempo_formateado }}
              </p>
              <hr>
              <p class="mb-0"><small>Equivalente a: {{ tiempo_total_horas|floatformat:2 }} horas o {{ tiempo_total_minutos|floatformat:2 }} minutos</small></p>
            </div>
          </div>

          <div class="mb-4">
            <h5>üìù Desglose de Tiempos</h5>
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Concepto</th>
                  <th class="text-end">Tiempo</th>
                  <th class="text-end">% del Total</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>‚è±Ô∏è Tiempo de Corte</td>
                  <td class="text-end">{{ tiempo_corte_minutos|floatformat:2 }} minutos</td>
                  <td class="text-end">{{ porcentaje_corte }}%</td>
                </tr>
                <tr>
                  <td>üîß Tiempo de Setup (Preparaci√≥n)</td>
                  <td class="text-end">{{ tiempo_setup_total|floatformat:2 }} minutos</td>
                  <td class="text-end">{{ porcentaje_setup }}%</td>
                </tr>
                <tr>
                  <td>üõ†Ô∏è Tiempo de Cambio de Herramienta</td>
                  <td class="text-end">{{ tiempo_cambio_total|floatformat:2 }} minutos</td>
                  <td class="text-end">{{ porcentaje_cambio }}%</td>
                </tr>
                <tr class="table-primary">
                  <td><strong>TOTAL</strong></td>
                  <td class="text-end"><strong>{{ tiempo_total_minutos|floatformat:2 }} minutos</strong></td>
                  <td class="text-end"><strong>100%</strong></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="mb-4">
            <h5>üìè Par√°metros Utilizados</h5>
            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6 class="text-muted">Velocidad de Corte</h6>
                    <p class="mb-0"><strong>{{ velocidad_corte }} cm/segundo</strong></p>
                    <small class="text-muted">Aproximadamente {{ velocidad_corte_cm_min }} cm/minuto</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6 class="text-muted">Tiempo de Setup por Tablero</h6>
                    <p class="mb-0"><strong>{{ tiempo_setup }} minutos</strong></p>
                    <small class="text-muted">Preparaci√≥n y posicionamiento</small>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <h6 class="text-muted">Tiempo de Cambio de Herramienta</h6>
                    <p class="mb-0"><strong>{{ tiempo_cambio_herramienta }} minutos</strong></p>
                    <small class="text-muted">Por cambio de herramienta</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-4">
            <h5>üìê Informaci√≥n T√©cnica</h5>
            <p><strong>Per√≠metro Total a Cortar:</strong> {{ perimetro_total|floatformat:2 }} cm</p>
            <p class="text-muted"><small>Este valor representa la suma de todos los per√≠metros de las piezas a cortar.</small></p>
          </div>

          <div class="alert alert-warning">
            <h6 class="alert-heading">‚ö†Ô∏è Nota Importante</h6>
            <p class="mb-0">
              Estos tiempos son estimaciones basadas en par√°metros est√°ndar. El tiempo real puede variar seg√∫n:
              <ul class="mb-0">
                <li>El tipo de material (madera, MDF, aglomerado, etc.)</li>
                <li>El tipo de herramienta de corte utilizada</li>
                <li>La experiencia del operador</li>
                <li>La complejidad de los cortes</li>
                <li>Condiciones del taller (temperatura, humedad, etc.)</li>
              </ul>
            </p>
          </div>

          <div class="text-center mt-4">
            <a href="{% url 'opticut:historial' %}" class="btn btn-secondary me-2">‚Üê Volver al Historial</a>
            <a href="{% url 'opticut:descargar_pdf' optimizacion.id %}" class="btn btn-primary">üìÑ Descargar PDF</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

