{% extends 'opticut/base.html' %}
{% block content %}
<div class="container mt-4">
  <h2 class="text-center fade-in">ğŸ“Š Resultado del Plan de Corte</h2>
  
  <!-- Resumen general -->
  <div class="row mt-4 fade-in">
    <div class="col-md-4">
      <div class="card text-center bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">Aprovechamiento</h5>
          <h2>{{ optimizacion.aprovechamiento_total|floatformat:2 }}%</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center bg-info text-white">
        <div class="card-body">
          <h5 class="card-title">Ãrea Utilizada</h5>
          <h2>{{ info_desperdicio.area_usada_total }} cmÂ²</h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-center bg-warning text-white">
        <div class="card-body">
          <h5 class="card-title">Desperdicio Total</h5>
          <h2>{{ info_desperdicio.desperdicio_total }} cmÂ²</h2>
        </div>
      </div>
    </div>
  </div>
  
  <p class="text-center mt-3">Total de tableros generados: <strong>{{ num_tableros }}</strong></p>
  
  <hr>
  
  <!-- Tabla de desperdicio por tablero -->
  <h4 class="mt-4 fade-in">ğŸ“Š Detalle por Tablero</h4>
  <div class="card fade-in">
  <table class="table table-striped table-hover mb-0">
    <thead class="table-dark">
      <tr>
        <th>Tablero</th>
        <th>Piezas</th>
        <th>Ãrea Usada</th>
        <th>Desperdicio</th>
        <th>Aprovechamiento</th>
      </tr>
    </thead>
    <tbody>
      {% for info in info_desperdicio.info_tableros %}
      <tr>
        <td><strong>Tablero {{ info.numero }}</strong></td>
        <td>{{ info.num_piezas }}</td>
        <td>{{ info.area_usada }} cmÂ²</td>
        <td>{{ info.desperdicio }} cmÂ²</td>
        <td>
          <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" 
                 style="width: {{ info.porcentaje_uso }}%" 
                 aria-valuenow="{{ info.porcentaje_uso }}" 
                 aria-valuemin="0" aria-valuemax="100">
              {{ info.porcentaje_uso }}%
            </div>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>
  
  <hr>
  
  <!-- Mostrar TODOS los tableros -->
  <h4 class="mt-4 fade-in">ğŸ“ Tableros Generados</h4>
  <div class="row fade-in">
    {% for img in imagenes %}
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header text-center bg-primary text-white">
          <h5>Tablero {{ forloop.counter }} de {{ num_tableros }}</h5>
        </div>
        <div class="card-body text-center">
          <img src="data:image/png;base64,{{ img }}" alt="Tablero {{ forloop.counter }}" class="img-fluid">
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  
  <hr>
  
  <!-- BotÃ³n para descargar PDF -->
  <div class="text-center mt-4 fade-in">
    {% if pdf_path %}
    <a href="/media/{{ pdf_path }}" class="btn btn-success btn-lg" download>
      ğŸ“„ Descargar PDF Completo
    </a>
    {% endif %}
  </div>
  
  <!-- BotÃ³n para volver -->
  <div class="text-center mt-4 mb-5 fade-in">
    <a href="{% url 'opticut:index' %}" class="btn btn-secondary btn-lg me-2">
      â† Volver al Optimizador
    </a>
    <a href="{% url 'opticut:mis_optimizaciones' %}" class="btn btn-info btn-lg">
      ğŸ“‹ Ver Historial
    </a>
  </div>
</div>
{% endblock %}