{% extends 'opticut/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'usuarios/css/perfil.css' %}">
{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-7">
      <div class="auth-card fade-in">
        <div class="auth-card-header bg-primary-custom">
          <h2 class="text-center mb-0">‚öôÔ∏è Configuraci√≥n de Perfil</h2>
          <p class="text-center text-muted mt-2 mb-0">Gestiona tu informaci√≥n personal y preferencias</p>
        </div>
        <div class="auth-card-body">
          
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <!-- Pesta√±as -->
          <ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="perfil-tab" data-bs-toggle="tab" data-bs-target="#perfil" type="button" role="tab">
                üë§ Informaci√≥n Personal
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="seguridad-tab" data-bs-toggle="tab" data-bs-target="#seguridad" type="button" role="tab">
                üîí Seguridad
              </button>
            </li>
          </ul>

          <div class="tab-content" id="profileTabsContent">
            <!-- Pesta√±a de Perfil -->
            <div class="tab-pane fade show active" id="perfil" role="tabpanel">
              <form method="post" class="auth-form" name="editar_perfil">
                {% csrf_token %}
                <input type="hidden" name="editar_perfil" value="1">
                
                <div class="form-group mb-3">
                  <label for="{{ perfil_form.username.id_for_label }}" class="form-label">
                    üë§ {{ perfil_form.username.label }}
                  </label>
                  {{ perfil_form.username }}
                  {% if perfil_form.username.errors %}
                    <div class="text-danger small mt-1">{{ perfil_form.username.errors }}</div>
                  {% endif %}
                  {% if perfil_form.username.help_text %}
                    <small class="form-text text-muted">{{ perfil_form.username.help_text }}</small>
                  {% endif %}
                </div>

                <div class="form-group mb-3">
                  <label for="{{ perfil_form.email.id_for_label }}" class="form-label">
                    üìß {{ perfil_form.email.label }}
                  </label>
                  {{ perfil_form.email }}
                  {% if perfil_form.email.errors %}
                    <div class="text-danger small mt-1">{{ perfil_form.email.errors }}</div>
                  {% endif %}
                </div>

                <div class="form-group mb-3">
                  <label for="{{ perfil_form.timeout_sesion.id_for_label }}" class="form-label">
                    ‚è±Ô∏è {{ perfil_form.timeout_sesion.label }}
                  </label>
                  <div class="input-group">
                    {{ perfil_form.timeout_sesion }}
                    
                  </div>
                  {% if perfil_form.timeout_sesion.errors %}
                    <div class="text-danger small mt-1">{{ perfil_form.timeout_sesion.errors }}</div>
                  {% endif %}
                  {% if perfil_form.timeout_sesion.help_text %}
                    <small class="form-text text-muted">{{ perfil_form.timeout_sesion.help_text }}</small>
                  {% endif %}
                  <div class="mt-2">
                    <small class="text-muted">
                      <strong>Valores sugeridos:</strong><br>
                      ‚Ä¢ 15 minutos - Mayor seguridad<br>
                      ‚Ä¢ 30 minutos - Balanceado (recomendado)<br>
                      ‚Ä¢ 60 minutos - Mayor comodidad<br>
                      ‚Ä¢ 0 - Desactivar timeout autom√°tico
                    </small>
                  </div>
                </div>

                <div class="form-group mb-4">
                  <label for="{{ perfil_form.tema_preferido.id_for_label }}" class="form-label">
                    üé® {{ perfil_form.tema_preferido.label }}
                  </label>
                  {{ perfil_form.tema_preferido }}
                  {% if perfil_form.tema_preferido.errors %}
                    <div class="text-danger small mt-1">{{ perfil_form.tema_preferido.errors }}</div>
                  {% endif %}
                </div>

                <div class="text-center">
                  <button type="submit" class="btn btn-primary btn-lg btn-auth">
                    üíæ Guardar Cambios
                  </button>
                </div>
              </form>
            </div>

            <!-- Pesta√±a de Seguridad -->
            <div class="tab-pane fade" id="seguridad" role="tabpanel">
              <form method="post" class="auth-form" name="cambiar_password">
                {% csrf_token %}
                <input type="hidden" name="cambiar_password" value="1">
                
                <div class="form-group mb-3">
                  <label for="{{ password_form.old_password.id_for_label }}" class="form-label">
                    üîë {{ password_form.old_password.label }}
                  </label>
                  {{ password_form.old_password }}
                  {% if password_form.old_password.errors %}
                    <div class="text-danger small mt-1">{{ password_form.old_password.errors }}</div>
                  {% endif %}
                </div>

                <div class="form-group mb-3">
                  <label for="{{ password_form.new_password1.id_for_label }}" class="form-label">
                    üîí {{ password_form.new_password1.label }}
                  </label>
                  {{ password_form.new_password1 }}
                  {% if password_form.new_password1.errors %}
                    <div class="text-danger small mt-1">{{ password_form.new_password1.errors }}</div>
                  {% endif %}
                  {% if password_form.new_password1.help_text %}
                    <small class="form-text text-muted">{{ password_form.new_password1.help_text }}</small>
                  {% endif %}
                </div>

                <div class="form-group mb-4">
                  <label for="{{ password_form.new_password2.id_for_label }}" class="form-label">
                    üîí {{ password_form.new_password2.label }}
                  </label>
                  {{ password_form.new_password2 }}
                  {% if password_form.new_password2.errors %}
                    <div class="text-danger small mt-1">{{ password_form.new_password2.errors }}</div>
                  {% endif %}
                  {% if password_form.new_password2.help_text %}
                    <small class="form-text text-muted">{{ password_form.new_password2.help_text }}</small>
                  {% endif %}
                </div>

                <div class="text-center">
                  <button type="submit" class="btn btn-success btn-lg btn-auth">
                    üîê Cambiar Contrase√±a
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="auth-card-footer">
          <div class="w-100 d-flex justify-content-end">
            <a href="{% url 'usuarios:logout' %}" class="btn btn-outline-danger">
              üö™ Cerrar sesi√≥n
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

